C51 COMPILER V9.54   IR                                                                    06/18/2018 22:07:45 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE IR
OBJECT MODULE PLACED IN ir.OBJ
COMPILER INVOKED BY: E:\Keil\Keil_v5\C51\BIN\C51.EXE ir.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "ir.h"
   2          
   3          /**********************************
   4          变量定义
   5          **********************************/
   6          uchar IrValue[6];
   7          uchar Time;
   8          extern uchar Command;
   9          uchar code smgduan[16]={
  10              '0','1','2','3','4','5','6','7',
  11              '8','9','A','B','C','D','E','F'};
  12          
  13          /*******************************************************************************
  14          * 函数名         : IrInit()
  15          * 函数功能       : 初始化红外线接收
  16          * 输入           : 无
  17          * 输出           : 无
  18          *******************************************************************************/
  19          void IrInit()
  20          {
  21   1        IT0=1;//下降沿触发
  22   1        EX0=1;//打开中断0允许
  23   1        EA=1; //打开总中断
  24   1      
  25   1        IRIN=1;//初始化端口
  26   1      }
  27          
  28          /*******************************************************************************
  29          * 函 数 名         : delay
  30          * 函数功能       : 延时函数，i=1时，大约延时10us
  31          *******************************************************************************/
  32          void delay(uint i)
  33          {
  34   1        while(i--); 
  35   1      }
  36          
  37          /*******************************************************************************
  38          * 函数名         : ReadIr()
  39          * 函数功能       : 读取红外数值的中断函数
  40          * 输入           : 无
  41          * 输出           : 无
  42          *******************************************************************************/
  43          void ReadIr() interrupt 0
  44          {
  45   1        uchar j,k;
  46   1        uint err;
  47   1        Time=0;        
  48   1        delay(700); //7ms 
  49   1        if(IRIN==0)   //确认是否真的接收到正确的信号
  50   1        {  
  51   2          err=1000;       //1000*10us=10ms,超过说明接收到错误的信号
  52   2          /*当两个条件都为真是循环，如果有一个条件为假的时候跳出循环，免得程序出错的时
  53   2          侯，程序死在这里*/  
  54   2          while((IRIN==0)&&(err>0)) //等待前面9ms的低电平过去     
  55   2          {     
C51 COMPILER V9.54   IR                                                                    06/18/2018 22:07:45 PAGE 2   

  56   3            delay(1);
  57   3            err--;
  58   3          } 
  59   2          if(IRIN==1)     //如果正确等到9ms低电平
  60   2          {
  61   3            err=500;
  62   3            while((IRIN==1)&&(err>0))    //等待4.5ms的起始高电平过去
  63   3            {
  64   4              delay(1);
  65   4              err--;
  66   4            }
  67   3            for(k=0;k<4;k++)    //共有4组数据
  68   3            {       
  69   4              for(j=0;j<8;j++)  //接收一组数据
  70   4              {
  71   5      
  72   5                err=60;   
  73   5                while((IRIN==0)&&(err>0))//等待信号前面的560us低电平过去
  74   5                {
  75   6                  delay(1);
  76   6                  err--;
  77   6                }
  78   5                err=500;
  79   5                while((IRIN==1)&&(err>0))  //计算高电平的时间长度。
  80   5                {
  81   6                  delay(10);   //0.1ms
  82   6                  Time++;
  83   6                  err--;
  84   6                  if(Time>30)
  85   6                  {
  86   7                    return;
  87   7                  }
  88   6                }
  89   5                IrValue[k]>>=1;  //k表示第几组数据
  90   5                if(Time>=8)     //如果高电平出现大于565us，那么是1
  91   5                {
  92   6                  IrValue[k]|=0x80;
  93   6                }
  94   5                Time=0;   //用完时间要重新赋值              
  95   5              }
  96   4            }
  97   3          }
  98   2          Command = smgduan[IrValue[2]%16];
  99   2        }     
 100   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    288    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =      7    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
